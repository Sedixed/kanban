{% extends 'base.html.twig' %}

{% block title %}
{{ kanban.name }}
{% endblock %}

{% block body %}

<h2 class="kanban-title">{{ kanban.name }}</h2>

<div class="kanban-container">
    <table class="kanban">
        <thead>
            {% for col in kanban.columns %}
                <th>
                    <div>{{ col.name }}</div>
                </th>
            {% endfor %}
        </thead>
        <tbody>
            {# Traverse the table horizontally and add the tasks #}
            {% for i in 0..maxTasks %}
                <tr>
                    {% for j in 0..(kanban.columns | length - 1) %}
                        {% if kanban.columns[j].tasks[i] is defined %}
                            <td>
                                <div>{{ kanban.columns[j].tasks[i].name }}</div>
                            </td>
                        {% elseif i == 0 or kanban.columns[j].tasks[i - 1] is defined %}
                            <td class="add-task">
                                <div>
                                    <button data-col-id="{{ kanban.columns[j].id }}">
                                        Ajouter une tâche
                                    </button>
                                </div>
                            </td>
                        {% else %}
                            <td class="invisible"></td>
                        {% endif %}
                    {% endfor %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<p>Utilisateurs invités :</p>
<ul>
    {% for inv in kanban.invitations %}
        <li>{{ inv.user.username }}</li>
    {% endfor %}
</ul>

{% if app.user == kanban.owner %}

{% for message in app.flashes('success') %}
    {# S'assurer que le flash est le bon (et pas celui de création de Kanban, qui est affiché à la première venue sur la page) #}
    {% if 'Utilisateur' in message %}
        <div class="success-flash">
            {{ message }}
        </div>
    {% endif %}
{% endfor %}

{% for message in app.flashes('warning') %}
    <div class="warning-flash">
        {{ message }}
    </div>
{% endfor %}

{% for message in app.flashes('error') %}
    <div class="failure-flash">
        {{ message }}
    </div>
{% endfor %}

<form 
    action="{{ path('invitation.send', {'id': kanban.id}) }}" 
    method="post">
    <div class="input-container">
        <input 
            type="text" 
            id="username" 
            name="username" 
            value="" placeholder="" required>
        <label for="username">Pseudonyme</label>
    </div>

    <button type="submit">Inviter sur le Kanban</button>
</form>
{% endif %}

{% endblock %}